<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Secure Payment</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
    margin:0;
    font-family:"Segoe UI",Arial,sans-serif;
    background:#f4f6f8;
    color:#333;
}
header{
    background:linear-gradient(135deg,#27ae60,#2ecc71);
    color:#fff;
    text-align:center;
    padding:40px 16px;
}
.container{
    max-width:520px;
    margin:30px auto;
    padding:20px;
}
.card{
    background:#fff;
    border-radius:20px;
    padding:26px;
    box-shadow:0 14px 35px rgba(0,0,0,.18);
}
.row{
    display:flex;
    justify-content:space-between;
    margin-bottom:12px;
    font-size:15px;
}
.amount{
    font-size:26px;
    font-weight:700;
    color:#27ae60;
    text-align:center;
    margin:20px 0;
}
.upi-btn{
    display:flex;
    align-items:center;
    justify-content:center;
    padding:14px;
    margin-top:12px;
    border-radius:14px;
    font-size:16px;
    font-weight:600;
    color:#fff;
    text-decoration:none;
}
.gpay{background:#000}
.phonepe{background:#5f259f}
.paytm{background:#002970}
.demo{
    background:#fff3cd;
    border-left:4px solid #f39c12;
    padding:12px;
    margin-top:16px;
    font-size:13px;
    color:#7a4f01;
    border-radius:8px;
}
.done{
    margin-top:18px;
    background:#27ae60;
    cursor:pointer;
}
.footer{
    background:#111;
    color:#aaa;
    padding:14px;
    text-align:center;
    font-size:13px;
    margin-top:40px;
}
.whatsapp{
    position:fixed;
    bottom:22px;
    right:20px;
    width:56px;
    height:56px;
    background:#25d366;
    color:#fff;
    border-radius:50%;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:28px;
    text-decoration:none;
}
</style>
</head>

<body>

<header>
<h1>üîí Secure Payment</h1>
<p>UPI Payment</p>
</header>

<div class="container">
<div class="card">

<h2>Booking Summary</h2>

<div class="row">
<strong>Booking ID</strong>
<span id="bookingId">-</span>
</div>

<div class="row">
<strong>Service</strong>
<span id="service">-</span>
</div>

<div class="row">
<strong>Details</strong>
<span id="details">-</span>
</div>

<div class="amount" id="amount">‚Çπ0</div>

<a id="gpay" class="upi-btn gpay">Pay with Google Pay</a>
<a id="phonepe" class="upi-btn phonepe">Pay with PhonePe</a>
<a id="paytm" class="upi-btn paytm">Pay with Paytm</a>

<div class="demo">
‚ö†Ô∏è Demo Mode: After payment click below
</div>

<div id="doneBtn" class="upi-btn done">
I have completed payment
</div>

<a href="javascript:history.back()"
   style="display:block;text-align:center;margin-top:16px;color:#555;">
Cancel
</a>

</div>
</div>

<div class="footer">
¬© 2025 ABC Restaurant & Resort
</div>

<a href="https://wa.me/919876543210"
   class="whatsapp"
   target="_blank">üí¨</a>

<script>
const params = new URLSearchParams(window.location.search);
const bookingId = params.get("id");

if(!bookingId){
    alert("Invalid access");
    window.location.href="index.html";
}

document.getElementById("bookingId").innerText = bookingId;

// FETCH BOOKING
fetch("http://127.0.0.1:10000/api/bookings/" + bookingId)
.then(res=>{
    if(!res.ok) throw new Error();
    return res.json();
})
.then(data=>{
    document.getElementById("service").innerText = data.service;
    document.getElementById("details").innerText = data.details;
    document.getElementById("amount").innerText = "‚Çπ " + data.amount;

    const upiId = "demo@upi";
    const name = "ABC Restaurant & Resort";
    const amount = data.amount;

    const upiLink =
      `upi://pay?pa=${upiId}&pn=${encodeURIComponent(name)}&am=${amount}&cu=INR`;

    gpay.href = phonepe.href = paytm.href = upiLink;
})
.catch(()=>{
    alert("Booking not found");
    window.location.href="index.html";
});

// PAYMENT COMPLETE ‚Üí UPDATE STATUS
document.getElementById("doneBtn").onclick = () => {
    fetch(`http://127.0.0.1:10000/api/bookings/${bookingId}/status`,{
        method:"PUT",
        headers:{ "Content-Type":"application/json" },
        body:JSON.stringify({ status:"PAID" })
    })
    .then(res=>{
        if(!res.ok) throw new Error();
        window.location.href="success.html?id=" + bookingId;
    })
    .catch(()=>{
        alert("Payment update failed");
    });
};
</script>

</body>
</html>
